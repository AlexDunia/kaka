import{u as C}from"./auth-Bl_OKKrm.js";import{K as P,L as q,r as f,d as D,_ as U,u as O,e as N,c as o,a as t,t as i,b as F,n as w,A as y,F as T,j as E,o as r}from"./index-DyY8Ujzr.js";import{p as R,u as j}from"./purchases-2xckHobk.js";const W=()=>{const d=new Date,_=new Date(d.getTime()-7*24*60*60*1e3),c=R.getAllPurchases().filter(e=>{const u=new Date(e.purchaseDate);return u>=_&&u<=d&&e.status==="confirmed"}),n={};for(let e=0;e<7;e++){const p=new Date(d.getTime()-e*24*60*60*1e3).toISOString().split("T")[0];n[p]={date:p,revenue:0,tickets:0}}c.forEach(e=>{const u=new Date(e.purchaseDate).toISOString().split("T")[0];n[u]&&(n[u].revenue+=e.totalPrice,n[u].tickets+=e.quantity)});const b=Object.values(n).sort((e,u)=>e.date.localeCompare(u.date)),v={};c.forEach(e=>{v[e.eventId]||(v[e.eventId]={eventId:e.eventId,eventTitle:e.eventTitle,quantity:0,revenue:0}),v[e.eventId].quantity+=e.quantity,v[e.eventId].revenue+=e.totalPrice});const l=Object.values(v).sort((e,u)=>u.quantity-e.quantity).slice(0,5),m=c.reduce((e,u)=>e+u.totalPrice,0),k=c.reduce((e,u)=>e+u.quantity,0),h=P.getAllEvents(),a=h.filter(e=>new Date(e.date)>d).sort((e,u)=>new Date(e.date)-new Date(u.date)).slice(0,5),S=h.filter(e=>e.availableTickets>0&&e.availableTickets<e.totalTickets*.1&&new Date(e.date)>d).sort((e,u)=>e.availableTickets/e.totalTickets-u.availableTickets/u.totalTickets).slice(0,5);return{periodStart:_.toISOString(),periodEnd:d.toISOString(),dailySales:b,topSellingEvents:l,totalRevenue:m,totalTickets:k,totalPurchases:c.length,upcomingEvents:a,lowStockEvents:S}},B=()=>{const d=R.getPurchaseStats();return{labels:Object.keys(d.salesByCategory),datasets:[{label:"Tickets Sold",data:Object.values(d.salesByCategory),backgroundColor:["#e84393","#a29bfe","#74b9ff","#55efc4","#ffeaa7","#fab1a0"]}]}},L=()=>{const d=new Date,_=new Date(d.getTime()-30*24*60*60*1e3),c=R.getAllPurchases().filter(l=>new Date(l.purchaseDate)>=_&&l.status==="confirmed"),n={};for(let l=0;l<30;l++){const k=new Date(d.getTime()-l*24*60*60*1e3).toISOString().split("T")[0];n[k]=0}c.forEach(l=>{const m=new Date(l.purchaseDate).toISOString().split("T")[0];n[m]!==void 0&&(n[m]+=l.totalPrice)});const b=Object.keys(n).sort(),v=b.map(l=>n[l]);return{labels:b,datasets:[{label:"Daily Revenue",data:v,borderColor:"#e84393",backgroundColor:"rgba(232, 67, 147, 0.2)",borderWidth:2,tension:.4,fill:!0}]}},A={getWeeklyReport:W,getCategorySalesChart:B,getRevenueChartData:L},M=q("reports",()=>{const d=f(null),_=f(null),g=f(null),c=f(!1),n=f(null),b=async()=>{if(!C().isAdmin)throw n.value="Unauthorized",new Error("Admin privileges required");c.value=!0,n.value=null;try{const e=await A.getWeeklyReport();return d.value=e,e}catch(e){throw n.value=e.message||"Failed to fetch weekly report",e}finally{c.value=!1}},v=async()=>{if(!C().isAdmin)throw n.value="Unauthorized",new Error("Admin privileges required");c.value=!0,n.value=null;try{const e=await A.getCategorySalesChart();return _.value=e,e}catch(e){throw n.value=e.message||"Failed to fetch category sales chart",e}finally{c.value=!1}},l=async()=>{if(!C().isAdmin)throw n.value="Unauthorized",new Error("Admin privileges required");c.value=!0,n.value=null;try{const e=await A.getRevenueChartData();return g.value=e,e}catch(e){throw n.value=e.message||"Failed to fetch revenue chart data",e}finally{c.value=!1}},m=D(()=>!!d.value),k=D(()=>d.value?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d.value.totalRevenue):"$0.00"),h=D(()=>d.value?d.value.lowStockEvents:[]),a=D(()=>d.value?d.value.upcomingEvents:[]);return{weeklyReport:d,categorySalesChart:_,revenueChartData:g,loading:c,error:n,hasReports:m,formattedTotalRevenue:k,lowStockEvents:h,upcomingEvents:a,fetchWeeklyReport:b,fetchCategorySalesChart:v,fetchRevenueChartData:l}}),$={class:"admin-page"},z={class:"container"},x={key:0,class:"admin-page__loading"},V={key:1,class:"admin-page__error"},K={key:2,class:"admin-page__content"},Y={class:"admin-tabs"},G={key:0,class:"admin-dashboard"},H={class:"admin-stats"},J={class:"admin-stat-card"},Q={class:"admin-stat-card__value"},X={class:"admin-stat-card"},Z={class:"admin-stat-card__value"},tt={class:"admin-stat-card"},et={class:"admin-stat-card__value"},at={class:"admin-section"},st={key:0,class:"admin-table"},nt={key:1,class:"admin-empty"},lt={class:"admin-section"},ot={key:0,class:"admin-table"},it={key:1,class:"admin-empty"},rt={key:1,class:"admin-events"},dt={class:"admin-section"},ut={key:0,class:"admin-table"},ct={key:1,class:"admin-empty"},vt={key:2,class:"admin-sales"},mt={class:"admin-section"},ht={key:0,class:"admin-table"},yt={key:1,class:"admin-empty"},bt={key:3,class:"admin-users"},_t={__name:"Admin",setup(d){const _=C(),g=O(),c=j(),n=M(),b=f(!0),v=f(null),l=f("dashboard");N(async()=>{if(!_.isAdmin){v.value="You do not have permission to access this page",b.value=!1;return}try{await Promise.all([g.fetchAllEvents(),c.fetchAllPurchases(),n.fetchWeeklyReport()])}catch(h){v.value=h.message||"Failed to load admin data"}finally{b.value=!1}});const m=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h),k=h=>new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return(h,a)=>{var S,e,u,p,I;return r(),o("div",$,[t("div",z,[a[17]||(a[17]=t("div",{class:"admin-page__header"},[t("h1",{class:"admin-page__title"},"Admin Dashboard"),t("p",{class:"admin-page__subtitle"},"Manage events, sales, and reports")],-1)),b.value?(r(),o("div",x,"Loading admin data...")):v.value?(r(),o("div",V,i(v.value),1)):(r(),o("div",K,[t("div",Y,[t("button",{class:w(["admin-tabs__button",{"admin-tabs__button--active":l.value==="dashboard"}]),onClick:a[0]||(a[0]=s=>l.value="dashboard")}," Dashboard ",2),t("button",{class:w(["admin-tabs__button",{"admin-tabs__button--active":l.value==="events"}]),onClick:a[1]||(a[1]=s=>l.value="events")}," Events ",2),t("button",{class:w(["admin-tabs__button",{"admin-tabs__button--active":l.value==="sales"}]),onClick:a[2]||(a[2]=s=>l.value="sales")}," Sales ",2),t("button",{class:w(["admin-tabs__button",{"admin-tabs__button--active":l.value==="users"}]),onClick:a[3]||(a[3]=s=>l.value="users")}," Users ",2)]),l.value==="dashboard"?(r(),o("div",G,[t("div",H,[t("div",J,[t("div",Q,i(y(g).events.length),1),a[4]||(a[4]=t("div",{class:"admin-stat-card__label"},"Total Events",-1))]),t("div",X,[t("div",Z,i(m(((S=y(n).weeklyReport)==null?void 0:S.totalRevenue)||0)),1),a[5]||(a[5]=t("div",{class:"admin-stat-card__label"},"Total Revenue",-1))]),t("div",tt,[t("div",et,i(((e=y(n).weeklyReport)==null?void 0:e.totalTickets)||0),1),a[6]||(a[6]=t("div",{class:"admin-stat-card__label"},"Tickets Sold",-1))])]),t("div",at,[a[8]||(a[8]=t("h2",{class:"admin-section__title"},"Low Stock Events",-1)),(u=y(n).lowStockEvents)!=null&&u.length?(r(),o("div",st,[t("table",null,[a[7]||(a[7]=t("thead",null,[t("tr",null,[t("th",null,"Event"),t("th",null,"Date"),t("th",null,"Available"),t("th",null,"Total"),t("th",null,"% Sold")])],-1)),t("tbody",null,[(r(!0),o(T,null,E(y(n).lowStockEvents,s=>(r(),o("tr",{key:s.id},[t("td",null,i(s.title),1),t("td",null,i(k(s.date)),1),t("td",null,i(s.availableTickets),1),t("td",null,i(s.totalTickets),1),t("td",null,i(Math.round((1-s.availableTickets/s.totalTickets)*100))+"% ",1)]))),128))])])])):(r(),o("div",nt,"No low stock events at the moment."))]),t("div",lt,[a[10]||(a[10]=t("h2",{class:"admin-section__title"},"Top Selling Events",-1)),(I=(p=y(n).weeklyReport)==null?void 0:p.topSellingEvents)!=null&&I.length?(r(),o("div",ot,[t("table",null,[a[9]||(a[9]=t("thead",null,[t("tr",null,[t("th",null,"Event"),t("th",null,"Tickets"),t("th",null,"Revenue")])],-1)),t("tbody",null,[(r(!0),o(T,null,E(y(n).weeklyReport.topSellingEvents,s=>(r(),o("tr",{key:s.eventId},[t("td",null,i(s.eventTitle),1),t("td",null,i(s.quantity),1),t("td",null,i(m(s.revenue)),1)]))),128))])])])):(r(),o("div",it,"No sales data available."))])])):l.value==="events"?(r(),o("div",rt,[t("div",dt,[a[13]||(a[13]=t("div",{class:"admin-section__header"},[t("h2",{class:"admin-section__title"},"Manage Events"),t("button",{class:"admin-btn admin-btn--primary"},"Add New Event")],-1)),y(g).events.length?(r(),o("div",ut,[t("table",null,[a[12]||(a[12]=t("thead",null,[t("tr",null,[t("th",null,"Title"),t("th",null,"Category"),t("th",null,"Date"),t("th",null,"Available/Total"),t("th",null,"Price"),t("th",null,"Actions")])],-1)),t("tbody",null,[(r(!0),o(T,null,E(y(g).events,s=>(r(),o("tr",{key:s.id},[t("td",null,i(s.title),1),t("td",null,i(s.category),1),t("td",null,i(k(s.date)),1),t("td",null,i(s.availableTickets)+"/"+i(s.totalTickets),1),t("td",null,i(m(s.price)),1),a[11]||(a[11]=t("td",{class:"admin-table__actions"},[t("button",{class:"admin-btn admin-btn--small"},"Edit"),t("button",{class:"admin-btn admin-btn--small admin-btn--danger"},"Delete")],-1))]))),128))])])])):(r(),o("div",ct,"No events found. Create your first event!"))])])):l.value==="sales"?(r(),o("div",vt,[t("div",mt,[a[15]||(a[15]=t("h2",{class:"admin-section__title"},"Recent Sales",-1)),y(c).purchases.length?(r(),o("div",ht,[t("table",null,[a[14]||(a[14]=t("thead",null,[t("tr",null,[t("th",null,"Event"),t("th",null,"Date"),t("th",null,"Customer"),t("th",null,"Tickets"),t("th",null,"Total"),t("th",null,"Status")])],-1)),t("tbody",null,[(r(!0),o(T,null,E(y(c).purchases.slice(0,10),s=>(r(),o("tr",{key:s.id},[t("td",null,i(s.eventTitle),1),t("td",null,i(k(s.purchaseDate)),1),t("td",null,"User #"+i(s.userId),1),t("td",null,i(s.quantity),1),t("td",null,i(m(s.totalPrice)),1),t("td",null,[t("span",{class:w({"admin-badge":!0,"admin-badge--success":s.status==="confirmed","admin-badge--danger":s.status==="cancelled"})},i(s.status),3)])]))),128))])])])):(r(),o("div",yt,"No sales data available."))])])):l.value==="users"?(r(),o("div",bt,a[16]||(a[16]=[t("div",{class:"admin-section"},[t("h2",{class:"admin-section__title"},"User Management"),t("p",{class:"admin-empty"},"User management functionality coming soon.")],-1)]))):F("",!0)]))])])}}},St=U(_t,[["__scopeId","data-v-8638bf00"]]);export{St as default};
